"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[828],{4828:(e,t,n)=>{n.r(t),n.d(t,{UpdateInlineImageDialog:()=>D,default:()=>I});var o=n(7022),i=n(1665),s=n(574),a=n.n(s),r=n(5174),l=n(5528),c=n(7827),d=n(4140),u=n(5523),m=n(2791),p=n(4555),g=n(8490),h=n(5743),f=n(253),C=n(4031),x=n(6616),b=n(2834),v=n(5590),E=n(7432),N=n(8361),M=n(9070),_=n(1577),S=n(4164);var O=n(592);const R=10,T=5;var L=n(184);function j(e){let{editor:t,anchorElem:n,isLink:o,isBold:i,isItalic:s,isUnderline:a,isCode:r,isStrikethrough:l,isSubscript:c,isSuperscript:p}=e;const g=(0,m.useRef)(null),h=(0,m.useCallback)((()=>{o?t.dispatchCommand(_.TOGGLE_LINK_COMMAND,null):t.dispatchCommand(_.TOGGLE_LINK_COMMAND,"https://")}),[t,o]);let f={x:0,y:0};function C(e){f={x:e.clientX,y:e.clientY}}function x(e){if(null!==g&&void 0!==g&&g.current&&(1===e.buttons||3===e.buttons)){Math.sqrt(Math.pow(e.clientX-f.x,2)+Math.pow(e.clientY-f.y,2))>5&&(g.current.style.pointerEvents="none")}}function b(e){null!==g&&void 0!==g&&g.current&&(g.current.style.pointerEvents="auto")}(0,m.useEffect)((()=>{if(null!==g&&void 0!==g&&g.current)return document.addEventListener("mousedown",C),document.addEventListener("mousemove",x),document.addEventListener("mouseup",b),()=>{document.removeEventListener("mousedown",C),document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",b)}}),[g]);const v=(0,m.useCallback)((()=>{const e=(0,u.$getSelection)(),o=g.current,i=window.getSelection();if(null===o)return;const s=t.getRootElement();if(null!==e&&null!==i&&!i.isCollapsed&&null!==s&&s.contains(i.anchorNode)){const e=function(e,t){const n=e.getRangeAt(0);let o;if(e.anchorNode===t){let e=t;for(;null!=e.firstElementChild;)e=e.firstElementChild;o=e.getBoundingClientRect()}else o=n.getBoundingClientRect();return o}(i,s);!function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:T;const s=n.parentElement;if(null===e||!s)return t.style.opacity="0",void(t.style.transform="translate(-10000px, -10000px)");const a=t.getBoundingClientRect(),r=n.getBoundingClientRect(),l=s.getBoundingClientRect();let c=e.top-a.height-o,d=e.left-i;c<l.top&&(c+=a.height+e.height+2*o),d+a.width>l.right&&(d=l.right-a.width-i),c-=r.top,d-=r.left,t.style.opacity="1",t.style.transform="translate(".concat(d,"px, ").concat(c,"px)")}(e,o,n)}}),[t,n]);return(0,m.useEffect)((()=>{const e=n.parentElement,o=()=>{t.getEditorState().read((()=>{v()}))};return window.addEventListener("resize",o),e&&e.addEventListener("scroll",o),()=>{window.removeEventListener("resize",o),e&&e.removeEventListener("scroll",o)}}),[t,v,n]),(0,m.useEffect)((()=>(t.getEditorState().read((()=>{v()})),(0,d.mergeRegister)(t.registerUpdateListener((e=>{let{editorState:t}=e;t.read((()=>{v()}))})),t.registerCommand(u.SELECTION_CHANGE_COMMAND,(()=>(v(),!1)),u.COMMAND_PRIORITY_LOW)))),[t,v]),(0,L.jsx)("div",{ref:g,className:"floating-text-format-popup",children:t.isEditable()&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"bold")},className:"popup-item spaced "+(i?"active":""),"aria-label":"Format text as bold",children:(0,L.jsx)("i",{className:"format bold"})}),(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"italic")},className:"popup-item spaced "+(s?"active":""),"aria-label":"Format text as italics",children:(0,L.jsx)("i",{className:"format italic"})}),(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"underline")},className:"popup-item spaced "+(a?"active":""),"aria-label":"Format text to underlined",children:(0,L.jsx)("i",{className:"format underline"})}),(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"strikethrough")},className:"popup-item spaced "+(l?"active":""),"aria-label":"Format text with a strikethrough",children:(0,L.jsx)("i",{className:"format strikethrough"})}),(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"subscript")},className:"popup-item spaced "+(c?"active":""),title:"Subscript","aria-label":"Format Subscript",children:(0,L.jsx)("i",{className:"format subscript"})}),(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"superscript")},className:"popup-item spaced "+(p?"active":""),title:"Superscript","aria-label":"Format Superscript",children:(0,L.jsx)("i",{className:"format superscript"})}),(0,L.jsx)("button",{onClick:()=>{t.dispatchCommand(u.FORMAT_TEXT_COMMAND,"code")},className:"popup-item spaced "+(r?"active":""),"aria-label":"Insert code block",children:(0,L.jsx)("i",{className:"format code"})}),(0,L.jsx)("button",{onClick:h,className:"popup-item spaced "+(o?"active":""),"aria-label":"Insert link",children:(0,L.jsx)("i",{className:"format link"})})]})})}function A(e){let{anchorElem:t=document.body}=e;const[n]=(0,i.useLexicalComposerContext)();return function(e,t){const[n,o]=(0,m.useState)(!1),[i,s]=(0,m.useState)(!1),[a,r]=(0,m.useState)(!1),[l,c]=(0,m.useState)(!1),[p,g]=(0,m.useState)(!1),[h,f]=(0,m.useState)(!1),[C,x]=(0,m.useState)(!1),[b,v]=(0,m.useState)(!1),[E,N]=(0,m.useState)(!1),R=(0,m.useCallback)((()=>{e.getEditorState().read((()=>{if(e.isComposing())return;const t=(0,u.$getSelection)(),n=window.getSelection(),i=e.getRootElement();if(null!==n&&(!(0,u.$isRangeSelection)(t)||null===i||!i.contains(n.anchorNode)))return void o(!1);if(!(0,u.$isRangeSelection)(t))return;const a=(0,O.P)(t);r(t.hasFormat("bold")),c(t.hasFormat("italic")),g(t.hasFormat("underline")),f(t.hasFormat("strikethrough")),x(t.hasFormat("subscript")),v(t.hasFormat("superscript")),N(t.hasFormat("code"));const l=a.getParent();(0,_.$isLinkNode)(l)||(0,_.$isLinkNode)(a)?s(!0):s(!1),(0,M.$isCodeHighlightNode)(t.anchor.getNode())||""===t.getTextContent()?o(!1):o((0,u.$isTextNode)(a));const d=t.getTextContent().replace(/\n/g,"");t.isCollapsed()||""!==d||o(!1)}))}),[e]);return(0,m.useEffect)((()=>(document.addEventListener("selectionchange",R),()=>{document.removeEventListener("selectionchange",R)})),[R]),(0,m.useEffect)((()=>(0,d.mergeRegister)(e.registerUpdateListener((()=>{R()})),e.registerRootListener((()=>{null===e.getRootElement()&&o(!1)})))),[e,R]),!n||i?null:(0,S.createPortal)((0,L.jsx)(j,{editor:e,anchorElem:t,isLink:i,isBold:a,isItalic:l,isStrikethrough:h,isSubscript:C,isSuperscript:b,isUnderline:p,isCode:E}),t)}(n,t)}const k=new Set;function w(e){let{altText:t,className:n,imageRef:o,src:i,width:s,height:a,position:r}=e;return function(e){if(!k.has(e))throw new Promise((t=>{const n=new Image;n.src=e,n.onload=()=>{k.add(e),t(null)}}))}(i),(0,L.jsx)("img",{className:n||void 0,src:i,alt:t,ref:o,"data-position":r,style:{height:a,width:s,display:"block"},draggable:"false"})}function D(e){let{activeEditor:t,nodeKey:n,onClose:o}=e;const i=t.getEditorState().read((()=>(0,u.$getNodeByKey)(n))),[s,a]=(0,m.useState)(i.getAltText()),[r,l]=(0,m.useState)(i.getShowCaption()),[c,d]=(0,m.useState)(i.getPosition());return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{style:{marginBottom:"1em"},children:(0,L.jsx)(x.Z,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:a,value:s,"data-test-id":"image-modal-alt-text-input"})}),(0,L.jsxs)(b.Z,{style:{marginBottom:"1em",width:"208px"},value:c,label:"Position",name:"position",id:"position-select",onChange:e=>{d(e.target.value)},children:[(0,L.jsx)("option",{value:"left",children:"Left"}),(0,L.jsx)("option",{value:"right",children:"Right"}),(0,L.jsx)("option",{value:"full",children:"Full Width"})]}),(0,L.jsxs)("div",{className:"Input__wrapper",children:[(0,L.jsx)("input",{id:"caption",type:"checkbox",checked:r,onChange:e=>{l(e.target.checked)}}),(0,L.jsx)("label",{htmlFor:"caption",children:"Show Caption"})]}),(0,L.jsx)(v.k,{children:(0,L.jsx)(E.Z,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const e={altText:s,showCaption:r,position:c};i&&t.update((()=>{i.update(e)})),o()})(),children:"Confirm"})})]})}function I(e){let{src:t,altText:n,nodeKey:s,width:x,height:b,showCaption:v,caption:E,position:M}=e;const[_,S]=(0,p.Z)(),O=(0,m.useRef)(null),R=(0,m.useRef)(null),[T,j,k]=(0,c.useLexicalNodeSelection)(s),[I]=(0,i.useLexicalComposerContext)(),[y,F]=(0,m.useState)(null),P=(0,m.useRef)(null),K=(0,m.useCallback)((e=>{if(T&&(0,u.$isNodeSelection)((0,u.$getSelection)())){e.preventDefault();const t=(0,u.$getNodeByKey)(s);(0,C.sU)(t)&&(null===t||void 0===t||t.remove()),j(!1)}return!1}),[T,s,j]),$=(0,m.useCallback)((e=>{const t=(0,u.$getSelection)(),n=R.current;if(T&&(0,u.$isNodeSelection)(t)&&1===t.getNodes().length){if(v)return(0,u.$setSelection)(null),e.preventDefault(),E.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1}),[E,T,v]),B=(0,m.useCallback)((e=>(P.current===E||R.current===e.target)&&((0,u.$setSelection)(null),I.update((()=>{j(!0);const e=I.getRootElement();null!==e&&e.focus()})),!0)),[E,I,j]);(0,m.useEffect)((()=>{let e=!0;const t=(0,d.mergeRegister)(I.registerUpdateListener((t=>{let{editorState:n}=t;e&&F(n.read((()=>(0,u.$getSelection)())))})),I.registerCommand(u.SELECTION_CHANGE_COMMAND,((e,t)=>(P.current=t,!1)),u.COMMAND_PRIORITY_LOW),I.registerCommand(u.CLICK_COMMAND,(e=>{const t=e;return t.target===O.current&&(t.shiftKey?j(!T):(k(),j(!0)),!0)}),u.COMMAND_PRIORITY_LOW),I.registerCommand(u.DRAGSTART_COMMAND,(e=>e.target===O.current&&(e.preventDefault(),!0)),u.COMMAND_PRIORITY_LOW),I.registerCommand(u.KEY_DELETE_COMMAND,K,u.COMMAND_PRIORITY_LOW),I.registerCommand(u.KEY_BACKSPACE_COMMAND,K,u.COMMAND_PRIORITY_LOW),I.registerCommand(u.KEY_ENTER_COMMAND,$,u.COMMAND_PRIORITY_LOW),I.registerCommand(u.KEY_ESCAPE_COMMAND,B,u.COMMAND_PRIORITY_LOW));return()=>{e=!1,t()}}),[k,I,T,s,K,$,B,j]);const Y=T&&(0,u.$isNodeSelection)(y),W=T;return(0,L.jsxs)(m.Suspense,{fallback:null,children:[(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{draggable:Y,children:[(0,L.jsx)("button",{className:"image-edit-button",ref:R,onClick:()=>{S("Update Inline Image",(e=>(0,L.jsx)(D,{activeEditor:I,nodeKey:s,onClose:e})))},children:"Edit"}),(0,L.jsx)(w,{className:W?"focused ".concat((0,u.$isNodeSelection)(y)?"draggable":""):null,src:t,altText:n,imageRef:O,width:x,height:b,position:M})]}),v&&(0,L.jsx)("div",{className:"image-caption-container",children:(0,L.jsxs)(r.LexicalNestedComposer,{initialEditor:E,children:[(0,L.jsx)(o.AutoFocusPlugin,{}),(0,L.jsx)(g.Z,{}),(0,L.jsx)(N.Z,{}),(0,L.jsx)(A,{}),(0,L.jsx)(l.RichTextPlugin,{contentEditable:(0,L.jsx)(h.Z,{className:"InlineImageNode__contentEditable"}),placeholder:(0,L.jsx)(f.Z,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:a()})]})})]}),_]})}},7022:(e,t,n)=>{const o=n(6164);e.exports=o},6164:(e,t,n)=>{var o=n(1665),i=n(2791);t.AutoFocusPlugin=function(e){let{defaultSelection:t}=e,[n]=o.useLexicalComposerContext();return i.useEffect((()=>{n.focus((()=>{let e=document.activeElement,t=n.getRootElement();null===t||null!==e&&t.contains(e)||t.focus({preventScroll:!0})}),{defaultSelection:t})}),[t,n]),null}},6390:(e,t,n)=>{const o=n(2060);e.exports=o},2060:(e,t,n)=>{var o=n(2791);let i=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],s=i[Math.floor(Math.random()*i.length)],a=o.createContext({clientID:0,color:s[1],isCollabActive:!1,name:s[0],yjsDocMap:new Map});t.CollaborationContext=a,t.useCollaborationContext=function(e,t){let n=o.useContext(a);return null!=e&&(n.name=e),null!=t&&(n.color=t),n}},5174:(e,t,n)=>{const o=n(8773);e.exports=o},8773:(e,t,n)=>{var o=n(6390),i=n(1665),s=n(2791);t.LexicalNestedComposer=function(e){let{initialEditor:t,children:n,initialNodes:a,initialTheme:r,skipCollabChecks:l}=e,c=s.useRef(!1),d=s.useContext(i.LexicalComposerContext);null==d&&function(e){let t=new URLSearchParams;t.append("code",e);for(let n=1;n<arguments.length;n++)t.append("v",arguments[n]);throw Error("Minified Lexical error #".concat(e,"; visit https://lexical.dev/docs/error?").concat(t," for the full message or ")+"use the non-minified dev environment for full errors and additional helpful warnings.")}(9);let[u,{getTheme:m}]=d,p=s.useMemo((()=>{var e=r||m()||void 0;const n=i.createLexicalComposerContext(d,e);if(void 0!==e&&(t._config.theme=e),t._parentEditor=u,a)for(var o of a){var s=e=null;"function"!==typeof o&&(o=(s=o).replace,e=s.with,s=s.withKlass||null);const n=t._nodes.get(o.getType());t._nodes.set(o.getType(),{exportDOM:n?n.exportDOM:void 0,klass:o,replace:e,replaceWithKlass:s,transforms:new Set})}else{o=t._nodes=new Map(u._nodes);for(const[e,n]of o)t._nodes.set(e,{exportDOM:n.exportDOM,klass:n.klass,replace:n.replace,replaceWithKlass:n.replaceWithKlass,transforms:new Set})}return t._config.namespace=u._config.namespace,t._editable=u._editable,[t,n]}),[]),{isCollabActive:g,yjsDocMap:h}=o.useCollaborationContext(),f=l||c.current||h.has(t.getKey());return s.useEffect((()=>{f&&(c.current=!0)}),[f]),s.useEffect((()=>u.registerEditableListener((e=>{t.setEditable(e)}))),[t,u]),s.createElement(i.LexicalComposerContext.Provider,{value:p},!g||f?n:null)}}}]);
//# sourceMappingURL=828.09c7d82c.chunk.js.map